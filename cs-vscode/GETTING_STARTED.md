# Getting Started with cs VS Code Extension

## Quick Start

### 1. Install Dependencies

```bash
cd cs-vscode
npm install
```

### 2. Compile the Extension

```bash
npm run compile
```

This compiles TypeScript to JavaScript in the `out/` directory.

### 3. Test the Extension

1. Open the `cs-vscode` folder in VS Code
2. Press `F5` to launch the Extension Development Host
3. In the new window, open a workspace folder
4. Click the cs icon in the activity bar (left sidebar)
5. Start searching!

### 4. Make Changes

- Edit files in `src/` - the extension TypeScript code
- Edit files in `webview/` - the search panel UI
- Run `npm run watch` to auto-compile on changes
- Reload the Extension Development Host with `Ctrl+R` / `Cmd+R`

## Architecture Overview

```tree
cs-vscode/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts       # Extension entry point, registers commands
â”‚   â”œâ”€â”€ searchPanel.ts     # Webview provider, manages search UI
â”‚   â”œâ”€â”€ cliAdapter.ts      # Spawns cs binary, parses results
â”‚   â””â”€â”€ types.ts           # TypeScript interfaces
â”œâ”€â”€ webview/
â”‚   â”œâ”€â”€ main.js           # Webview UI logic
â”‚   â”œâ”€â”€ styles.css        # TUI-inspired styling
â”‚   â””â”€â”€ (index.html is generated by searchPanel.ts)
â”œâ”€â”€ package.json          # Extension manifest, commands, config
â””â”€â”€ tsconfig.json         # TypeScript configuration
```

## How It Works

### CLI Mode (Phase 1 - Current)

1. User types in search box
2. After 300ms debounce, webview sends message to extension
3. Extension spawns `cs --jsonl --hybrid "query" /path`
4. cc outputs JSONL results to stdout
5. Extension parses results and sends to webview
6. Webview renders results
7. User clicks result â†’ extension opens file at line

### Message Flow

```text
Webview                Extension              cs Binary
   |                       |                      |
   |--{ type: 'search' }-->|                      |
   |                       |--spawn("cs ...")---->|
   |                       |                      |
   |                       |<--JSONL results------|
   |<--{ searchResults }---|                      |
   |                       |                      |
   |--{ type: 'openFile'}->|                      |
   |                       |--vscode.open()       |
```

## Testing Checklist

- [ ] Search with hybrid mode works
- [ ] Search with semantic mode works
- [ ] Search with regex mode works
- [ ] Clicking result opens file at correct line
- [ ] Keyboard navigation (â†‘/â†“) works
- [ ] Enter key opens selected result
- [ ] Debouncing works (no spam)
- [ ] Reindex button works
- [ ] Index status updates correctly
- [ ] Search selection command works
- [ ] Extension activates on startup

## Next Steps (Phase 2+)

### MCP Integration

To add MCP support:

1. Create `src/mcpAdapter.ts` - JSON-RPC client for `cs --serve`
2. Update `searchPanel.ts` to use MCP or CLI based on config
3. Add streaming support for incremental results
4. Add progress notifications

### Enhancements

- Syntax highlighting in result previews (use VS Code's TextMate grammars)
- Peek view for inline results
- Multi-workspace support
- Result filtering UI
- Search history

## Packaging for Distribution

```shell
# Install vsce if not already installed
npm install -g @vscode/vsce

# Package the extension
npm run package

# This creates cs-search-0.1.0.vsix
```

Install locally:

```shell
code --install-extension cs-search-0.1.0.vsix
```

## Troubleshooting

### Extension doesn't activate

- Check the Output panel (View â†’ Output) and select "cs"
- Look for errors in Developer Tools (Help â†’ Toggle Developer Tools)

### cs binary not found

- Ensure `cs` is in PATH: `which cs` or `where cs`
- Set `cs.cliPath` in settings to absolute path

### Search returns no results

- Check cs works in terminal: `cs --sem "test" .`
- Look at stderr output in Developer Tools console

### Webview not loading

- Check CSP errors in Developer Tools
- Verify webview resources exist in `webview/` directory

## Development Tips

- Use `console.log()` in webview code - it appears in Developer Tools
- Use `console.log()` in extension code - it appears in Debug Console
- Set breakpoints in TypeScript files
- Use `vscode.window.showInformationMessage()` for quick debugging
- Check the Extension Host log: View â†’ Output â†’ Extension Host

Enjoy building! ðŸš€
